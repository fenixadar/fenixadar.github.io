<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>威联通NAS TS-873A 实测 | FenixAdar&#39;s Blog</title><meta name="description" content="一、为什么要NAS？虽然每个人都有各自的理由，但核心诉求点集中在安全存储和备份分享数据，支持远程访问，可安装包括虚拟化、web服务器等的额外拓展等。NAS的本质是网络+存储。 我使用NAS主要目的是：  在存算分离环境中，通过iSCSI服务，使用NAS提供的储存服务。 安全存储并备份虚拟化系统所必需的文件。 安全存储并备份文档，照片等文件。  二、NAS有哪些可选项目前家用NAS，可以选择DIY自"><meta property="og:type" content="article"><meta property="og:title" content="威联通NAS TS-873A 实测"><meta property="og:url" content="https://fenixadar.github.io/2022/08/15/%E5%A8%81%E8%81%94%E9%80%9ANAS%20TS-873A%20%E5%AE%9E%E6%B5%8B/index.html"><meta property="og:site_name" content="FenixAdar Blog"><meta property="og:description" content="一、为什么要NAS？虽然每个人都有各自的理由，但核心诉求点集中在安全存储和备份分享数据，支持远程访问，可安装包括虚拟化、web服务器等的额外拓展等。NAS的本质是网络+存储。 我使用NAS主要目的是：  在存算分离环境中，通过iSCSI服务，使用NAS提供的储存服务。 安全存储并备份虚拟化系统所必需的文件。 安全存储并备份文档，照片等文件。  二、NAS有哪些可选项目前家用NAS，可以选择DIY自"><meta property="og:locale"><meta property="article:published_time" content="2022-08-15T02:43:05.000Z"><meta property="article:modified_time" content="2022-10-01T05:14:58.273Z"><meta property="article:author" content="FenixAdar"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://fenixadar.github.io/2022/08/15/%E5%A8%81%E8%81%94%E9%80%9ANAS%20TS-873A%20%E5%AE%9E%E6%B5%8B/index.html"><link rel="alternate" href="/atom.xml" title="FenixAdar Blog" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 6.2.0"></head><body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/fenixadar" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">FenixAdar</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Xiamen, China</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="Search"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">Home</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">Archives</span></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">Board</h3><div class="widget-body"><div id="board"><div class="content"></div></div></div></div><div class="widget"><h3 class="widget-title">Archive</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a><span class="archive-list-count">2</span></li></ul></div></div><div class="widget"><h3 class="widget-title">Recent Posts</h3><div class="widget-body"><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2022/10/01/%E4%BC%A0%E7%BB%9F%E4%BC%81%E4%B8%9A%E6%95%B0%E5%AD%97%E5%8C%96%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/" class="title">传统企业数字化架构设计</a></p><p class="item-date"><time datetime="2022-10-01T03:07:43.000Z" itemprop="datePublished">2022-10-01</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2022/09/10/%E4%B8%AA%E4%BA%BA%E8%99%9A%E6%8B%9F%E5%8C%96%E5%AD%98%E7%AE%97%E5%88%86%E7%A6%BB%E6%94%B9%E9%80%A0/" class="title">个人虚拟化存算分离改造</a></p><p class="item-date"><time datetime="2022-09-10T03:06:41.000Z" itemprop="datePublished">2022-09-10</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2022/08/15/%E5%A8%81%E8%81%94%E9%80%9ANAS%20TS-873A%20%E5%AE%9E%E6%B5%8B/" class="title">威联通NAS TS-873A 实测</a></p><p class="item-date"><time datetime="2022-08-15T02:43:05.000Z" itemprop="datePublished">2022-08-15</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2022/08/04/%E6%9E%81%E7%AE%80Prometheus%E7%9B%91%E6%8E%A7%E5%AE%9E%E6%88%98/" class="title">极简Prometheus监控实战</a></p><p class="item-date"><time datetime="2022-08-04T02:47:39.000Z" itemprop="datePublished">2022-08-04</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2021/10/28/goframe%E4%B8%8Egin%E5%AF%B9%E6%AF%94(%E5%9B%9B)%20%E6%95%B0%E6%8D%AE%E8%BF%94%E5%9B%9E%E3%80%81Cookie%E3%80%81session%E3%80%81HTTPClient/" class="title">goframe与gin对比(四) 数据返回、Cookie、session、HTTPClient</a></p><p class="item-date"><time datetime="2021-10-28T10:51:05.000Z" itemprop="datePublished">2021-10-28</time></p></div></li></ul></div></div></div></aside><main class="main" role="main"><div class="content"><article id="post-威联通NAS TS-873A 实测" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">威联通NAS TS-873A 实测</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/2022/08/15/%E5%A8%81%E8%81%94%E9%80%9ANAS%20TS-873A%20%E5%AE%9E%E6%B5%8B/" class="article-date"><time datetime="2022-08-15T02:43:05.000Z" itemprop="datePublished">2022-08-15</time> </a></span><span class="article-read hidden-xs"><i class="icon icon-eye-fill" aria-hidden="true"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span> </span></span><span class="post-comment"><i class="icon icon-comment"></i> <a href="/2022/08/15/%E5%A8%81%E8%81%94%E9%80%9ANAS%20TS-873A%20%E5%AE%9E%E6%B5%8B/#comments" class="article-comment-link">Comments</a></span> <span class="post-wordcount hidden-xs" itemprop="wordCount">Word Count: 5.3k(words)</span> <span class="post-readcount hidden-xs" itemprop="timeRequired">Read Count: 22(minutes)</span></div></div><div class="article-entry marked-body" itemprop="articleBody"><h1 id="一、为什么要NAS？"><a href="#一、为什么要NAS？" class="headerlink" title="一、为什么要NAS？"></a>一、为什么要NAS？</h1><p>虽然每个人都有各自的理由，但核心诉求点集中在安全存储和备份分享数据，支持远程访问，可安装包括虚拟化、web服务器等的额外拓展等。NAS的本质是网络+存储。</p><p>我使用NAS主要目的是：</p><ol><li>在存算分离环境中，通过iSCSI服务，使用NAS提供的储存服务。</li><li>安全存储并备份虚拟化系统所必需的文件。</li><li>安全存储并备份文档，照片等文件。</li></ol><h1 id="二、NAS有哪些可选项"><a href="#二、NAS有哪些可选项" class="headerlink" title="二、NAS有哪些可选项"></a>二、NAS有哪些可选项</h1><p>目前家用NAS，可以选择DIY自建，即自己购买硬件组装搭建NAS，NAS本质上也是一台计算机，只是在功能上偏向于存储而已，操作系统可以选择存储专用的FreeNAS的系统，也可以直接购买成品，诸如威联通、群晖、铁威马等。对于没有太多计算机基础的小伙伴，建议就不要自行搭建了，挑选硬件和系统容易交学费，故障排查繁琐。</p><p>个人之前用过铁威马，感觉是具备基础的NAS功能，如果只是想简单安全备份存储文件，铁威马确实够用了，性价比高。但就功能性和额外拓展的能力相比威联通和群晖，确实稍弱。鉴于本人使用NAS的目的，综合考虑后，购买了威联通的TS-873A。之前也考虑过价格相近的商用的机架式的NAS设备，诸如TS-832PXU，但企业级设备噪音较大，家用无法忍受。</p><p>选择TS-873A，我的核心诉求点如下：</p><ol><li><p>8盘位可提供足够的磁盘空间，组RAID10后还可以有热备磁盘位，未来很长一段时间内都不需要再升级设备。<br>如果4盘位，组建RAID10后是没有热备磁盘位的。另外，为什么不组RAID5的原因主要是，RAID10性能会更好些，万一出现故障恢复速度也快，RAID10虽然只能用一半的空间，但目前硬盘价格并不贵，其实是可以接受的。</p></li><li><p>内置 M.2 NVMe SSD 槽位，可利用SSD加速读写速度。<br>2个M.2 NVMe SSD，可以组RAID1，做读写缓存或者Qtier自动分层存储，大大加速读写速度，解决HDD硬盘较慢的问题。如果2个SSD插槽不够用，还可以再购买SSD扩展卡配件，873A有PCIe Gen3x4的插槽。</p></li><li><p>额外有2个PCIe Gen3x4插槽<br>可以安装额外的配件，诸如SSD扩展卡，万兆网卡等。我自己就买了25GbE的双口光纤网卡，原装是2个2.5G的电口网卡，大大提升了网络速度，让网络速度不再成为瓶颈点。不仅如此，加配件后可支持FC SAN环境。</p></li><li><p>价格合适，这点很重要<br>再往上，9盘位，高度过高，会占用机柜更多U的空间，12盘位又太贵。当然，就价格太贵什么的，完全不是对方的问题，是我的太穷的问题。</p></li><li><p>支持UPS</p></li><li><p>几乎没有什么噪音</p></li></ol><p>还有一些特性，我暂时用不着，诸如可扩充显卡，远程访问，搭建虚拟化环境等。可以访问<code>https://www.qnap.com.cn/zh-cn/product/ts-873a</code>看下官方的介绍。</p><h1 id="三、实际体验与改造"><a href="#三、实际体验与改造" class="headerlink" title="三、实际体验与改造"></a>三、实际体验与改造</h1><ol><li><p>外包装挺厚实的，保护机体用的泡沫也很大。机体自身挺沉的，大概15斤左右。机体下方有缓冲垫，如果你放在镜面的桌子上，或者机柜的托盘上，会有点粘在上面的感觉，不容易造成移动，拿起时需要先往上使点力。</p></li><li><p>拆开外壳，主板位于侧面，包括内存条，M2插槽。PCIe接口在上方，PCIe扩展体验不是非常好，空间不大，很小的螺丝刀才能正着伸进去，稍微大一点的螺丝刀就需要侧着拧。</p></li><li><p>我把内存升级了内存到32GB，原厂自带8GB内存有点小。hero系统比较吃内存，如果需要用hero的raid10，需要16GB以上。</p></li><li><p>加装了一块25GbE双端口的网卡，我买配件的时候，10G的刚好没货，才买的25G，事实上买10GbE的即可。</p></li><li><p>置入2块三星M2 NVMe SSD 970EVO Plus。这里要吐槽下威联通的SSD谜之兼容性。因为硬件本身也在升级，威联通并不会及时更新。比如，三星SSD的EVO 或者 EVO Plus 型号名称出现微小的变化，主要在型号后缀，可能会很难买到完全一模一样的型号。按照<code>https://www.qnap.com.cn/zh-cn/compatibility/?model=522&amp;category=ssd</code>官方的兼容性列表，威联通官方测试过，”970 EVO Plus MZ-V7S1T0” 和 “970 EVO MZ-V7E1T0BW” 是可兼容的，但事实上，目前能买到的”970 EVO Plus MZ-V7S1T0B” 我亲测是兼容的，但是 “970 EVO MZ-V7E1T0” 却又不兼容。不兼容的症状是会导致一些奇奇怪怪的问题，系统并不会提示什么，可以开机，机体上的指示灯也一切正常，就是实际运行不正常。</p></li><li><p>置入4块希捷银河ExosX18系列企业级氦气硬盘 ST16000NM000J 16TB 256MB 7200RPM。个人经验是，第一是硬盘的水很深，真的不要找不熟悉的渠道去购买特别低价的硬盘，老老实实找正规渠道买，第二是注意各种门的问题，可以去找下对应的型号并避开。我自己目前都买希捷的银河系列企业级的硬盘。</p></li></ol><h1 id="四、开始实验"><a href="#四、开始实验" class="headerlink" title="四、开始实验"></a>四、开始实验</h1><p>威联通NAS有两种系统，一种是传统的QTS，基于EXT4，另一种是 QuTS hero，基于ZFS。先说下结论，最终我还是用的QTS。虽然hero有许多高级特性，诸如去重，块大小可选等等，但对于我而言，稳定性更重要，高级功能虽然好但非必须，hero对机器性能的要求要远高于QTS，hero系统一旦初始设定完磁盘，就难以变更。虽然最终未使用hero系统，但我依然针对hero系统做了一系列的实际测试。</p><p>注意下，因为硬件所限，部分对照实验仅供参考，实验环境如下：</p><h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><p>NAS与服务器均使用万兆电缆连接到交换机上，网络环境不成为速度瓶颈点</p><ol><li>8口10GbE万兆全SFP+光口交换机</li><li>10G万兆高速SFP+ DAC电缆</li></ol><h2 id="NAS"><a href="#NAS" class="headerlink" title="NAS"></a>NAS</h2><ol><li>HDD硬盘：4块 希捷银河ExosX18系列企业级氦气硬盘 ST16000NM000J 16TB 256MB 7200RPM</li><li>SSD硬盘：2块 三星M2 NVMe SSD 970EVO Plus</li><li>内存32GB，完全满足hero的要求，实验过程中，内存占有率均在50%以下。</li><li>25GbE网卡（可向下兼容10GbE），网络环境不成为瓶颈点。</li></ol><p>安装系统并创建存储池与区块LUN，开启iSCSI。安装好系统后，注意以下2点：</p><ol><li>组建RAID后，设置为服务优先。</li><li>在网络适配器选项卡处，给使用的网卡设定固定IPv4地址，巨帧封包设定为最大的9000，关闭IPv6，关闭FEC。</li></ol><h2 id="服务器"><a href="#服务器" class="headerlink" title="服务器"></a>服务器</h2><ol><li>硬件配置是 AMD Ryzen7 3800X 内存128GB</li><li>单独一块SATA SSD用于安装ESXi 7.0</li><li>在一块服务器本地HDD硬盘上，创建win10虚拟机，分配8核32GB内存，HDD型号是 希捷银河Exos7E8系列企业级硬盘 ST8000NM000A 8TB 256MB 7200RPM</li><li>主板上安装有一块三星M2 NVMe SSD 970 EVO MZ-V7E1T0</li><li>网卡是Intel 82599芯片 10G万兆SFP+光纤网卡</li></ol><p>服务器上还做了以下设置：</p><ol><li>ESXi网络的标准交换机，设定MTU为9000，win10的网卡属性，设置开启巨帧Jumbo Packet</li><li>按照<code>https://www.ibm.com/docs/zh/sanvolumecontroller/8.3.x?topic=problem-iscsi-performance-analysis-tuning</code>，禁用ESXi和win10上的TCP延迟应答功能，并开启iSCSI巨帧。</li></ol><h2 id="测试软件"><a href="#测试软件" class="headerlink" title="测试软件"></a>测试软件</h2><p>使用CrystalDiskMark 6.0.2 x64版本。测试次数选5，大小32GiB，测试队列数与线程数使用默认项，分别是顺序写入Q32T1、随机4K Q8T8、随机4K Q32T1、随机4K Q1T1</p><h2 id="测试说明"><a href="#测试说明" class="headerlink" title="测试说明"></a>测试说明</h2><ul><li>所有磁盘传输速度单位均是 MB&#x2F;s</li><li>由于10G网络限制，部分测试项，特别是顺序读，已经达到网络传输速率上限，造成无法有效测量真实IO速度</li><li>多次重复测量，数值可能会有变化，变化幅度最大在15%左右。</li></ul><p>测试维度有：</p><ol><li>NAS操作系统，分别是 QTS系统和QuTS hero系统</li><li>磁盘类型，分别是 M2 NVMe SSD 和 HDD</li><li>RAID类型，针对 0，1，5，10 进行测试，其中SSD仅测试RAID1。</li><li>加速方式，针对不开启、高速缓存加速、Qtier三种方式进行测试，hero只有高速缓存加速功能。</li><li>连接方式，分别是使用win10直连iSCSI和使用vmware通过iSCSI连接后创建存储空间配置给win10虚拟机用。</li><li>块大小，QTS和QuTS hero的选项不同，QTS选项是512Bytes和4KB，hero是32k(vmware)，64k（Hybrid），128k（视频&#x2F;大型文件&#x2F;备份）。但QTS LUN 4KB块大小，vmware通过iSCSI无法识别到，但win10通过iSCSI正常识别。</li><li>同步I&#x2F;O，ZFS Intent Log (ZIL) 同步设置，仅hero有这个选项</li></ol><p>缩写：</p><ol><li>操作系统，QuTS hero 缩写为 hero</li><li>磁盘类型，M2 NVMe SSD 缩写为 M2 SSD</li><li>连接渠道，win10直连iSCSI缩写为 win10 ，使用vmware通过iSCSI连接后配置缩写为 vm</li></ol><h2 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h2><h3 id="对比-QTS-系统-和-QuTS-hero-系统的磁盘速度"><a href="#对比-QTS-系统-和-QuTS-hero-系统的磁盘速度" class="headerlink" title="对比 QTS 系统 和 QuTS hero 系统的磁盘速度"></a>对比 QTS 系统 和 QuTS hero 系统的磁盘速度</h3><p>测试环境：</p><ol><li>不开启加速，不使用Qtier</li><li>全部使用win10通过iSCSI方式连接NAS</li><li>QTS系统块大小统一设置512Bytes，hero系统块大小统一设置64K</li><li>QTS系统无ZIL同步IO配置，hero系统ZIL同步IO设置为不使用，本机磁盘无此项配置</li></ol><table><thead><tr><th align="left">系统类型</th><th align="right">QTS</th><th align="right">hero</th><th align="right">QTS</th><th align="right">hero</th><th align="right">QTS</th><th align="right">hero</th></tr></thead><tbody><tr><td align="left">磁盘类型</td><td align="right">M2 SSD</td><td align="right">M2 SSD</td><td align="right">M2 SSD</td><td align="right">M2 SSD</td><td align="right">M2 SSD</td><td align="right">M2 SSD</td></tr><tr><td align="left">RAID类型</td><td align="right">无</td><td align="right">无</td><td align="right">RAID 0</td><td align="right">RAID 0</td><td align="right">RAID 1</td><td align="right">RAID 1</td></tr><tr><td align="left">Seq Q32T1 Read</td><td align="right">1210</td><td align="right">1237</td><td align="right">1233</td><td align="right">1237</td><td align="right">1235</td><td align="right">1237</td></tr><tr><td align="left">Seq Q32T1 Write</td><td align="right">711</td><td align="right">704</td><td align="right">1196</td><td align="right">989</td><td align="right">715</td><td align="right">763</td></tr><tr><td align="left">4KB Q8T8 Read</td><td align="right">307</td><td align="right">272</td><td align="right">308</td><td align="right">346</td><td align="right">307</td><td align="right">352</td></tr><tr><td align="left">4KB Q8T8 Write</td><td align="right">278</td><td align="right">25</td><td align="right">333</td><td align="right">38</td><td align="right">280</td><td align="right">34</td></tr><tr><td align="left">4KB Q32T1 Read</td><td align="right">350</td><td align="right">361</td><td align="right">353</td><td align="right">382</td><td align="right">368</td><td align="right">391</td></tr><tr><td align="left">4KB Q32T1 Write</td><td align="right">249</td><td align="right">32</td><td align="right">264</td><td align="right">71</td><td align="right">258</td><td align="right">42</td></tr><tr><td align="left">4KB Q1T1 Read</td><td align="right">15</td><td align="right">18</td><td align="right">15</td><td align="right">18</td><td align="right">15</td><td align="right">21</td></tr><tr><td align="left">4KB Q1T1 Write</td><td align="right">21</td><td align="right">7.1</td><td align="right">20</td><td align="right">8.6</td><td align="right">20</td><td align="right">6.8</td></tr></tbody></table><table><thead><tr><th align="left">系统类型</th><th align="right">QTS</th><th align="right">hero</th><th align="right">QTS</th><th align="right">hero</th><th align="right">QTS</th><th align="right">hero</th><th align="right">QTS</th><th align="right">hero</th></tr></thead><tbody><tr><td align="left">磁盘类型</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD</td></tr><tr><td align="left">RAID类型</td><td align="right">无</td><td align="right">无</td><td align="right">RAID 0</td><td align="right">RAID 0</td><td align="right">RAID 1</td><td align="right">RAID 1</td><td align="right">RAID 10</td><td align="right">RAID 10</td></tr><tr><td align="left">Seq Q32T1 Read</td><td align="right">1209</td><td align="right">965</td><td align="right">1222</td><td align="right">958</td><td align="right">934</td><td align="right">941</td><td align="right">1228</td><td align="right">1190</td></tr><tr><td align="left">Seq Q32T1 Write</td><td align="right">293</td><td align="right">259</td><td align="right">531</td><td align="right">293</td><td align="right">285</td><td align="right">312</td><td align="right">539</td><td align="right">534</td></tr><tr><td align="left">4KB Q8T8 Read</td><td align="right">276</td><td align="right">40</td><td align="right">279</td><td align="right">67</td><td align="right">218</td><td align="right">67</td><td align="right">306</td><td align="right">103</td></tr><tr><td align="left">4KB Q8T8 Write</td><td align="right">17</td><td align="right">17</td><td align="right">60</td><td align="right">18</td><td align="right">13</td><td align="right">18</td><td align="right">47</td><td align="right">27</td></tr><tr><td align="left">4KB Q32T1 Read</td><td align="right">259</td><td align="right">43</td><td align="right">215</td><td align="right">69</td><td align="right">217</td><td align="right">67</td><td align="right">357</td><td align="right">100</td></tr><tr><td align="left">4KB Q32T1 Write</td><td align="right">33</td><td align="right">14</td><td align="right">56</td><td align="right">17</td><td align="right">28</td><td align="right">17</td><td align="right">54</td><td align="right">25</td></tr><tr><td align="left">4KB Q1T1 Read</td><td align="right">15</td><td align="right">21</td><td align="right">16</td><td align="right">21</td><td align="right">16</td><td align="right">20</td><td align="right">15</td><td align="right">19</td></tr><tr><td align="left">4KB Q1T1 Write</td><td align="right">21</td><td align="right">14</td><td align="right">21</td><td align="right">13</td><td align="right">18</td><td align="right">14</td><td align="right">20</td><td align="right">14</td></tr></tbody></table><ol><li>顺序读写场景，两个系统的IO性能差异较小</li><li>不管是磁盘类型是SSD还是HDD，hero系统的随机4K文件IO性能都低于QTS</li></ol><h3 id="实测-M2-NVMe-SSD-与-HDD-的速度"><a href="#实测-M2-NVMe-SSD-与-HDD-的速度" class="headerlink" title="实测 M2 NVMe SSD 与 HDD 的速度"></a>实测 M2 NVMe SSD 与 HDD 的速度</h3><p>测试环境：</p><ol><li>统一不使用RAID</li><li>不开启加速，不使用Qtier</li><li>全部使用win10通过iSCSI方式连接NAS</li><li>QTS系统块大小统一设置512Bytes，hero系统块大小统一设置64K</li><li>QTS系统无ZIL同步IO配置，hero系统ZIL同步IO设置为不使用，本机磁盘无此项配置</li></ol><table><thead><tr><th align="left">磁盘类型</th><th align="right">本机 M2 SSD</th><th align="right">M2 SSD</th><th align="right">M2 SSD</th><th align="right">本机 HDD</th><th align="right">HDD</th><th align="right">HDD</th></tr></thead><tbody><tr><td align="left">系统类型</td><td align="right">略</td><td align="right">QTS</td><td align="right">hero</td><td align="right">略</td><td align="right">QTS</td><td align="right">hero</td></tr><tr><td align="left">Seq Q32T1 Read</td><td align="right">3550</td><td align="right">1210</td><td align="right">1237</td><td align="right">222</td><td align="right">1209</td><td align="right">965</td></tr><tr><td align="left">Seq Q32T1 Write</td><td align="right">1913</td><td align="right">711</td><td align="right">704</td><td align="right">199</td><td align="right">293</td><td align="right">259</td></tr><tr><td align="left">4KB Q8T8 Read</td><td align="right">878</td><td align="right">307</td><td align="right">272</td><td align="right">1.32</td><td align="right">276</td><td align="right">40</td></tr><tr><td align="left">4KB Q8T8 Write</td><td align="right">900</td><td align="right">278</td><td align="right">25</td><td align="right">20</td><td align="right">17</td><td align="right">17</td></tr><tr><td align="left">4KB Q32T1 Read</td><td align="right">425</td><td align="right">350</td><td align="right">361</td><td align="right">1.37</td><td align="right">259</td><td align="right">43</td></tr><tr><td align="left">4KB Q32T1 Write</td><td align="right">328</td><td align="right">249</td><td align="right">32</td><td align="right">12</td><td align="right">33</td><td align="right">14</td></tr><tr><td align="left">4KB Q1T1 Read</td><td align="right">39</td><td align="right">15</td><td align="right">18</td><td align="right">0.41</td><td align="right">15</td><td align="right">21</td></tr><tr><td align="left">4KB Q1T1 Write</td><td align="right">97</td><td align="right">21</td><td align="right">7.1</td><td align="right">16</td><td align="right">21</td><td align="right">14</td></tr></tbody></table><h3 id="实测-RAID-0，1，5，10"><a href="#实测-RAID-0，1，5，10" class="headerlink" title="实测 RAID 0，1，5，10"></a>实测 RAID 0，1，5，10</h3><p>测试环境：</p><ol><li>NAS安装QTS系统</li><li>不开启加速，不使用Qtier</li><li>全部使用win10通过iSCSI方式连接NAS</li><li>QTS系统块大小统一设置512Bytes</li><li>QTS系统无ZIL同步IO配置</li></ol><table><thead><tr><th align="left">RAID类型</th><th align="right">无</th><th align="right">RAID 0</th><th align="right">RAID 1</th><th align="right">无</th><th align="right">RAID 0</th><th align="right">RAID 1</th><th align="right">RAID 5</th><th align="right">RAID 10</th></tr></thead><tbody><tr><td align="left">磁盘类型</td><td align="right">M2 SSD</td><td align="right">M2 SSD</td><td align="right">M2 SSD</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD</td></tr><tr><td align="left">Seq Q32T1 Read</td><td align="right">1210</td><td align="right">1233</td><td align="right">1235</td><td align="right">1209</td><td align="right">1222</td><td align="right">1210</td><td align="right">1224</td><td align="right">1228</td></tr><tr><td align="left">Seq Q32T1 Write</td><td align="right">711</td><td align="right">1196</td><td align="right">715</td><td align="right">293</td><td align="right">531</td><td align="right">280</td><td align="right">455</td><td align="right">539</td></tr><tr><td align="left">4KB Q8T8 Read</td><td align="right">307</td><td align="right">308</td><td align="right">307</td><td align="right">276</td><td align="right">279</td><td align="right">278</td><td align="right">287</td><td align="right">306</td></tr><tr><td align="left">4KB Q8T8 Write</td><td align="right">278</td><td align="right">333</td><td align="right">280</td><td align="right">17</td><td align="right">60</td><td align="right">16</td><td align="right">28</td><td align="right">47</td></tr><tr><td align="left">4KB Q32T1 Read</td><td align="right">350</td><td align="right">353</td><td align="right">368</td><td align="right">259</td><td align="right">215</td><td align="right">211</td><td align="right">226</td><td align="right">357</td></tr><tr><td align="left">4KB Q32T1 Write</td><td align="right">249</td><td align="right">264</td><td align="right">258</td><td align="right">33</td><td align="right">56</td><td align="right">32</td><td align="right">23</td><td align="right">54</td></tr><tr><td align="left">4KB Q1T1 Read</td><td align="right">15</td><td align="right">15</td><td align="right">15</td><td align="right">15</td><td align="right">16</td><td align="right">16</td><td align="right">16</td><td align="right">15</td></tr><tr><td align="left">4KB Q1T1 Write</td><td align="right">21</td><td align="right">20</td><td align="right">20</td><td align="right">21</td><td align="right">21</td><td align="right">21</td><td align="right">22</td><td align="right">20</td></tr></tbody></table><h3 id="QTS系统中，对比高速缓存加速与Qtier的读写速度"><a href="#QTS系统中，对比高速缓存加速与Qtier的读写速度" class="headerlink" title="QTS系统中，对比高速缓存加速与Qtier的读写速度"></a>QTS系统中，对比高速缓存加速与Qtier的读写速度</h3><p>测试环境：</p><ol><li>NAS安装QTS系统</li><li>高速缓存和Qtier高速层均设置RAID 1读写缓存</li><li>QTS系统块大小统一设置512Bytes</li><li>QTS系统无ZIL同步IO配置</li></ol><table><thead><tr><th align="left">加速方式</th><th align="right">不开启</th><th align="right">不开启</th><th align="right">高速缓存</th><th align="right">高速缓存</th><th align="right">Qtier</th><th align="right">Qtier</th></tr></thead><tbody><tr><td align="left">磁盘类型</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD+SSD</td><td align="right">HDD+SSD</td><td align="right">HDD+SSD</td><td align="right">HDD+SSD</td></tr><tr><td align="left">连接渠道</td><td align="right">win10</td><td align="right">vm</td><td align="right">win10</td><td align="right">vm</td><td align="right">win10</td><td align="right">vm</td></tr><tr><td align="left">RAID类型</td><td align="right">RAID 1</td><td align="right">RAID 1</td><td align="right">RAID 1</td><td align="right">RAID 1</td><td align="right">RAID 1</td><td align="right">RAID 1</td></tr><tr><td align="left">Seq Q32T1 Read</td><td align="right">934</td><td align="right">900</td><td align="right">1233</td><td align="right">955</td><td align="right">1235</td><td align="right">950</td></tr><tr><td align="left">Seq Q32T1 Write</td><td align="right">285</td><td align="right">278</td><td align="right">718</td><td align="right">708</td><td align="right">286</td><td align="right">280</td></tr><tr><td align="left">4KB Q8T8 Read</td><td align="right">218</td><td align="right">225</td><td align="right">299</td><td align="right">420</td><td align="right">311</td><td align="right">360</td></tr><tr><td align="left">4KB Q8T8 Write</td><td align="right">13</td><td align="right">37</td><td align="right">234</td><td align="right">256</td><td align="right">13</td><td align="right">28</td></tr><tr><td align="left">4KB Q32T1 Read</td><td align="right">217</td><td align="right">139</td><td align="right">242</td><td align="right">314</td><td align="right">337</td><td align="right">269</td></tr><tr><td align="left">4KB Q32T1 Write</td><td align="right">28</td><td align="right">28</td><td align="right">233</td><td align="right">244</td><td align="right">17</td><td align="right">16</td></tr><tr><td align="left">4KB Q1T1 Read</td><td align="right">16</td><td align="right">33</td><td align="right">18</td><td align="right">35</td><td align="right">15</td><td align="right">33</td></tr><tr><td align="left">4KB Q1T1 Write</td><td align="right">18</td><td align="right">30</td><td align="right">21</td><td align="right">32</td><td align="right">21</td><td align="right">25</td></tr></tbody></table><table><thead><tr><th align="left">加速方式</th><th align="right">不开启</th><th align="right">不开启</th><th align="right">高速缓存</th><th align="right">高速缓存</th><th align="right">Qtier</th><th align="right">Qtier</th></tr></thead><tbody><tr><td align="left">磁盘类型</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD+SSD</td><td align="right">HDD+SSD</td><td align="right">HDD+SSD</td><td align="right">HDD+SSD</td></tr><tr><td align="left">连接渠道</td><td align="right">win10</td><td align="right">vm</td><td align="right">win10</td><td align="right">vm</td><td align="right">win10</td><td align="right">vm</td></tr><tr><td align="left">RAID类型</td><td align="right">RAID 10</td><td align="right">RAID 10</td><td align="right">RAID 10</td><td align="right">RAID 10</td><td align="right">RAID 10</td><td align="right">RAID 10</td></tr><tr><td align="left">Seq Q32T1 Read</td><td align="right">1228</td><td align="right">942</td><td align="right">1214</td><td align="right">930</td><td align="right">1232</td><td align="right">916</td></tr><tr><td align="left">Seq Q32T1 Write</td><td align="right">539</td><td align="right">536</td><td align="right">719</td><td align="right">702</td><td align="right">508</td><td align="right">508</td></tr><tr><td align="left">4KB Q8T8 Read</td><td align="right">306</td><td align="right">326</td><td align="right">366</td><td align="right">415</td><td align="right">301</td><td align="right">380</td></tr><tr><td align="left">4KB Q8T8 Write</td><td align="right">47</td><td align="right">45</td><td align="right">180</td><td align="right">256</td><td align="right">59</td><td align="right">26</td></tr><tr><td align="left">4KB Q32T1 Read</td><td align="right">357</td><td align="right">233</td><td align="right">382</td><td align="right">312</td><td align="right">241</td><td align="right">301</td></tr><tr><td align="left">4KB Q32T1 Write</td><td align="right">54</td><td align="right">55</td><td align="right">240</td><td align="right">242</td><td align="right">26</td><td align="right">27</td></tr><tr><td align="left">4KB Q1T1 Read</td><td align="right">15</td><td align="right">34</td><td align="right">17</td><td align="right">31</td><td align="right">17</td><td align="right">33</td></tr><tr><td align="left">4KB Q1T1 Write</td><td align="right">20</td><td align="right">32</td><td align="right">18</td><td align="right">29</td><td align="right">22</td><td align="right">32</td></tr></tbody></table><p>高速缓存加速是利用SSD作为缓存用于改进NAS的读写性能，加速分3种，只读加速、只写加速、读写加速。加速用的SSD，RAID可选项有不启用，RAID 0，1，5，6，10。只读加速可以组RAID0，因为并不存在数据丢失风险，RAID 0 是最优选项。只写或者读写缓存，建议使用RAID 1，5，6，10，避免因为SSD本身故障导致数据丢失或损坏的情况。高速缓存加速读的原理是，当从LUN或卷读取数据时，QTS将数据复制到SSD缓存以加速未来的读取请求。加速写的原理是QTS先将传入数据写入SSD缓存，然后再将数据刷新到常规存储。如果新数据在缓存中，对新数据的读取访问也会加速。</p><p>Qtier简单描述就是，QTS系统会根据存储设备速度将存储进行分层，然后按照数据访问频率，再各层之间移动数据。将经常访问的数据移动到最快速的磁盘，以提高读写性能，并将不常访问的数据移动到大容量的磁盘，降低存储成本。</p><ul><li>Seq Q32T1 Read，无论是RAID 1 还是10，有无开缓存，都基本触及或接近10G网络的速度上限。</li><li>Seq Q32T1 Write，不开启缓存，基本和RAID 1 和 RAID 10 实际速度接近，高速缓存加速的写速度其实就是SSD的写入速度，和高速缓存原理的描述一致。Qtier的写入，RAID 1 和 10 接近2倍的差异，而且和HDD写入速度接近，猜测应该是直接写到HDD磁盘上的。</li><li>4KB Q8T8 Read，速度差异小。</li><li>4KB Q8T8 Write，Qtier和不开启加速的速度是接近的，高速缓存速度是最快的。</li><li>4KB Q32T1 Read，速度也相对较小。</li><li>4KB Q32T1 Write，不开启加速和开启高速缓存的结果和预期的一致，高速缓存的写速预期是应该和写入SSD 的 RAID 1 速度差不多，测试结果相近。但Qtier性能较差，甚至比不开启加速的速度更低，我甚至一度怀疑我测试有问题，特意多次测量，但结果依然不佳，这点让我不是很理解。</li><li>4KB Q1T1 Read，速度差异小。</li><li>4KB Q1T1 Write，不论什么RAID类型，是否开启加速，速度差异都不大。</li></ul><p>从实验结果看，顺序读取由于触及网络上限，可能真实速度还可以再更快一些，毕竟 安装在本地的 M2 SSD 顺序读取都可以到 3500 MB&#x2F;s 这样的速度了。关于顺序文件写入，由于Qtier是直接写入到HDD，所以速度比较低。关于4K文件的读，速度大抵和预期的差不多，高速缓存的速度和做RAID 1的SSD读速相近，Qtier和 做 RAID 10 的 HDD 读速相近。而在写性能方面，特别是在随机并行写入的场景下，高速缓存优势明显。虽然所有涉及Qiter的测试，在测试前我已经把相关的LUN设置为Qiter必做分层的LUN了，且手动执行了分层优化的任务，但因为我的实验场景是随机数据写入，所以从实验结果上看，Qtier优势不大，真实场景下性能应该会好一些。</p><p>总之，如果是有很多随机小文件读写的场景，诸如虚拟化等，用高速缓存加速更合适。而Qtier，更适合IO可预测的场景，诸如文件服务器等。</p><h3 id="QTS-系统中，LUN不同大小的块的速度"><a href="#QTS-系统中，LUN不同大小的块的速度" class="headerlink" title="QTS 系统中，LUN不同大小的块的速度"></a>QTS 系统中，LUN不同大小的块的速度</h3><p>测试环境：</p><ol><li>NAS安装QTS系统</li><li>不开启加速，不使用Qtier</li><li>全部使用win10通过iSCSI方式连接NAS</li><li>没有ZIL同步配置项</li></ol><table><thead><tr><th align="left">磁盘类型</th><th align="right">M2 SSD</th><th align="right">M2 SSD</th><th align="right">M2 SSD</th><th align="right">M2 SSD</th><th align="right">M2 SSD</th><th align="right">M2 SSD</th></tr></thead><tbody><tr><td align="left">RAID类型</td><td align="right">无</td><td align="right">无</td><td align="right">RAID 0</td><td align="right">RAID 0</td><td align="right">RAID 1</td><td align="right">RAID 1</td></tr><tr><td align="left">块大小</td><td align="right">512 B</td><td align="right">4 KB</td><td align="right">512 B</td><td align="right">4 KB</td><td align="right">512 B</td><td align="right">4 KB</td></tr><tr><td align="left">Seq Q32T1 Read</td><td align="right">1210</td><td align="right">1217</td><td align="right">1233</td><td align="right">1235</td><td align="right">1235</td><td align="right">1232</td></tr><tr><td align="left">Seq Q32T1 Write</td><td align="right">711</td><td align="right">717</td><td align="right">1196</td><td align="right">1229</td><td align="right">715</td><td align="right">716</td></tr><tr><td align="left">4KB Q8T8 Read</td><td align="right">307</td><td align="right">310</td><td align="right">308</td><td align="right">301</td><td align="right">307</td><td align="right">299</td></tr><tr><td align="left">4KB Q8T8 Write</td><td align="right">278</td><td align="right">313</td><td align="right">333</td><td align="right">292</td><td align="right">280</td><td align="right">293</td></tr><tr><td align="left">4KB Q32T1 Read</td><td align="right">350</td><td align="right">358</td><td align="right">353</td><td align="right">244</td><td align="right">368</td><td align="right">341</td></tr><tr><td align="left">4KB Q32T1 Write</td><td align="right">249</td><td align="right">248</td><td align="right">264</td><td align="right">240</td><td align="right">258</td><td align="right">251</td></tr><tr><td align="left">4KB Q1T1 Read</td><td align="right">15</td><td align="right">15</td><td align="right">15</td><td align="right">18</td><td align="right">15</td><td align="right">16</td></tr><tr><td align="left">4KB Q1T1 Write</td><td align="right">21</td><td align="right">22</td><td align="right">20</td><td align="right">21</td><td align="right">20</td><td align="right">20</td></tr></tbody></table><table><thead><tr><th align="left">磁盘类型</th><th align="right">HDD</th><th align="right">HDD</th><th align="right">HDD</th><th align="right">HDD</th><th align="right">HDD</th><th align="right">HDD</th><th align="right">HDD</th><th align="right">HDD</th></tr></thead><tbody><tr><td align="left">RAID类型</td><td align="right">无</td><td align="right">无</td><td align="right">RAID 0</td><td align="right">RAID 0</td><td align="right">RAID 1</td><td align="right">RAID 1</td><td align="right">RAID 10</td><td align="right">RAID 10</td></tr><tr><td align="left">块大小</td><td align="right">512 B</td><td align="right">4 KB</td><td align="right">512 B</td><td align="right">4 KB</td><td align="right">512 B</td><td align="right">4 KB</td><td align="right">512 B</td><td align="right">4 KB</td></tr><tr><td align="left">Seq Q32T1 Read</td><td align="right">1209</td><td align="right">944</td><td align="right">1222</td><td align="right">1234</td><td align="right">934</td><td align="right">1186</td><td align="right">1228</td><td align="right">1221</td></tr><tr><td align="left">Seq Q32T1 Write</td><td align="right">293</td><td align="right">280</td><td align="right">531</td><td align="right">534</td><td align="right">285</td><td align="right">266</td><td align="right">539</td><td align="right">525</td></tr><tr><td align="left">4KB Q8T8 Read</td><td align="right">276</td><td align="right">61</td><td align="right">279</td><td align="right">295</td><td align="right">218</td><td align="right">304</td><td align="right">306</td><td align="right">353</td></tr><tr><td align="left">4KB Q8T8 Write</td><td align="right">17</td><td align="right">16</td><td align="right">60</td><td align="right">60</td><td align="right">13</td><td align="right">19</td><td align="right">47</td><td align="right">58</td></tr><tr><td align="left">4KB Q32T1 Read</td><td align="right">259</td><td align="right">70</td><td align="right">215</td><td align="right">229</td><td align="right">217</td><td align="right">312</td><td align="right">357</td><td align="right">324</td></tr><tr><td align="left">4KB Q32T1 Write</td><td align="right">33</td><td align="right">26</td><td align="right">56</td><td align="right">56</td><td align="right">28</td><td align="right">30</td><td align="right">54</td><td align="right">46</td></tr><tr><td align="left">4KB Q1T1 Read</td><td align="right">15</td><td align="right">16</td><td align="right">16</td><td align="right">16</td><td align="right">16</td><td align="right">16</td><td align="right">15</td><td align="right">15</td></tr><tr><td align="left">4KB Q1T1 Write</td><td align="right">21</td><td align="right">21</td><td align="right">21</td><td align="right">21</td><td align="right">18</td><td align="right">20</td><td align="right">20</td><td align="right">22</td></tr></tbody></table><p>QTS系统中，针对不同的块大小，即使是在不同RAID场景下，并没有显著的性能区别。</p><h3 id="QuTS-hero-系统中，LUN不同大小的块的速度"><a href="#QuTS-hero-系统中，LUN不同大小的块的速度" class="headerlink" title="QuTS hero 系统中，LUN不同大小的块的速度"></a>QuTS hero 系统中，LUN不同大小的块的速度</h3><p>测试环境：</p><ol><li>NAS安装QuTS hero 系统</li><li>不开启加速，不使用Qtier</li><li>全部使用win10通过iSCSI方式连接NAS</li><li>ZIL同步IO设置为不使用</li></ol><table><thead><tr><th align="left">块大小</th><th align="right">32 KB</th><th align="right">64 KB</th><th align="right">128 KB</th></tr></thead><tbody><tr><td align="left">磁盘类型</td><td align="right">M2 SSD</td><td align="right">M2 SSD</td><td align="right">M2 SSD</td></tr><tr><td align="left">RAID类型</td><td align="right">RAID 1</td><td align="right">RAID 1</td><td align="right">RAID 1</td></tr><tr><td align="left">Seq Q32T1 Read</td><td align="right">1234</td><td align="right">1237</td><td align="right">1236</td></tr><tr><td align="left">Seq Q32T1 Write</td><td align="right">697</td><td align="right">763</td><td align="right">708</td></tr><tr><td align="left">4KB Q8T8 Read</td><td align="right">339</td><td align="right">352</td><td align="right">250</td></tr><tr><td align="left">4KB Q8T8 Write</td><td align="right">75</td><td align="right">34</td><td align="right">21</td></tr><tr><td align="left">4KB Q32T1 Read</td><td align="right">399</td><td align="right">391</td><td align="right">211</td></tr><tr><td align="left">4KB Q32T1 Write</td><td align="right">80</td><td align="right">42</td><td align="right">21</td></tr><tr><td align="left">4KB Q1T1 Read</td><td align="right">21</td><td align="right">21</td><td align="right">18</td></tr><tr><td align="left">4KB Q1T1 Write</td><td align="right">9.4</td><td align="right">6.8</td><td align="right">5.9</td></tr></tbody></table><table><thead><tr><th align="left">块大小</th><th align="right">32 KB</th><th align="right">64 KB</th><th align="right">128 KB</th><th align="right">32 KB</th><th align="right">64 KB</th><th align="right">128 KB</th><th align="right">32 KB</th><th align="right">64 KB</th><th align="right">128 KB</th></tr></thead><tbody><tr><td align="left">RAID类型</td><td align="right">RAID 0</td><td align="right">RAID 0</td><td align="right">RAID 0</td><td align="right">RAID 1</td><td align="right">RAID 1</td><td align="right">RAID 1</td><td align="right">RAID 10</td><td align="right">RAID 10</td><td align="right">RAID 10</td></tr><tr><td align="left">磁盘类型</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD</td></tr><tr><td align="left">Seq Q32T1 Read</td><td align="right">925</td><td align="right">958</td><td align="right">957</td><td align="right">907</td><td align="right">941</td><td align="right">960</td><td align="right">1205</td><td align="right">1190</td><td align="right">1208</td></tr><tr><td align="left">Seq Q32T1 Write</td><td align="right">294</td><td align="right">293</td><td align="right">288</td><td align="right">318</td><td align="right">312</td><td align="right">249</td><td align="right">473</td><td align="right">534</td><td align="right">528</td></tr><tr><td align="left">4KB Q8T8 Read</td><td align="right">68</td><td align="right">67</td><td align="right">58</td><td align="right">65</td><td align="right">67</td><td align="right">55</td><td align="right">107</td><td align="right">103</td><td align="right">88</td></tr><tr><td align="left">4KB Q8T8 Write</td><td align="right">25</td><td align="right">18</td><td align="right">10</td><td align="right">26</td><td align="right">18</td><td align="right">9.0</td><td align="right">47</td><td align="right">27</td><td align="right">15</td></tr><tr><td align="left">4KB Q32T1 Read</td><td align="right">68</td><td align="right">69</td><td align="right">60</td><td align="right">67</td><td align="right">67</td><td align="right">58</td><td align="right">98</td><td align="right">100</td><td align="right">85</td></tr><tr><td align="left">4KB Q32T1 Write</td><td align="right">25</td><td align="right">17</td><td align="right">10</td><td align="right">26</td><td align="right">17</td><td align="right">8.9</td><td align="right">43</td><td align="right">25</td><td align="right">14</td></tr><tr><td align="left">4KB Q1T1 Read</td><td align="right">19</td><td align="right">21</td><td align="right">19</td><td align="right">19</td><td align="right">20</td><td align="right">21</td><td align="right">19</td><td align="right">19</td><td align="right">20</td></tr><tr><td align="left">4KB Q1T1 Write</td><td align="right">14</td><td align="right">13</td><td align="right">10</td><td align="right">13</td><td align="right">14</td><td align="right">9.0</td><td align="right">14</td><td align="right">14</td><td align="right">14</td></tr></tbody></table><p>和QTS系统相同的是，Quts hero系统顺序读写，小文件随机读，性能差异不大。但随机写小文件场景下，不同块大小的速度，写性能差异较大。</p><h3 id="QuTS-hero-系统中，对比ZIL同步设置对磁盘性能的影响"><a href="#QuTS-hero-系统中，对比ZIL同步设置对磁盘性能的影响" class="headerlink" title="QuTS hero 系统中，对比ZIL同步设置对磁盘性能的影响"></a>QuTS hero 系统中，对比ZIL同步设置对磁盘性能的影响</h3><p>测试环境：</p><ol><li>NAS安装QuTS hero 系统</li><li>不开启加速，不使用Qtier</li><li>全部使用win10通过iSCSI方式连接NAS</li><li>QuTS hero系统块大小统一设置64K</li></ol><table><thead><tr><th align="left">ZIL同步设置</th><th align="right">不使用</th><th align="right">始终</th><th align="right">不使用</th><th align="right">始终</th></tr></thead><tbody><tr><td align="left">磁盘类型</td><td align="right">M2 SSD</td><td align="right">M2 SSD</td><td align="right">M2 SSD</td><td align="right">M2 SSD</td></tr><tr><td align="left">RAID类型</td><td align="right">无</td><td align="right">无</td><td align="right">RAID 0</td><td align="right">RAID 0</td></tr><tr><td align="left">Seq Q32T1 Read</td><td align="right">1237</td><td align="right">1222</td><td align="right">1237</td><td align="right">1236</td></tr><tr><td align="left">Seq Q32T1 Write</td><td align="right">704</td><td align="right">219</td><td align="right">989</td><td align="right">322</td></tr><tr><td align="left">4KB Q8T8 Read</td><td align="right">272</td><td align="right">247</td><td align="right">346</td><td align="right">351</td></tr><tr><td align="left">4KB Q8T8 Write</td><td align="right">25</td><td align="right">17</td><td align="right">38</td><td align="right">22</td></tr><tr><td align="left">4KB Q32T1 Read</td><td align="right">361</td><td align="right">332</td><td align="right">382</td><td align="right">390</td></tr><tr><td align="left">4KB Q32T1 Write</td><td align="right">32</td><td align="right">13</td><td align="right">71</td><td align="right">15</td></tr><tr><td align="left">4KB Q1T1 Read</td><td align="right">18</td><td align="right">18</td><td align="right">18</td><td align="right">21</td></tr><tr><td align="left">4KB Q1T1 Write</td><td align="right">7.1</td><td align="right">1.9</td><td align="right">8.6</td><td align="right">2.4</td></tr></tbody></table><table><thead><tr><th align="left">ZIL同步设置</th><th align="right">不使用</th><th align="right">始终</th><th align="right">不使用</th><th align="right">始终</th><th align="right">不使用</th><th align="right">始终</th></tr></thead><tbody><tr><td align="left">磁盘类型</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD</td><td align="right">HDD</td></tr><tr><td align="left">RAID类型</td><td align="right">无</td><td align="right">无</td><td align="right">RAID 0</td><td align="right">RAID 0</td><td align="right">RAID 10</td><td align="right">RAID 10</td></tr><tr><td align="left">Seq Q32T1 Read</td><td align="right">965</td><td align="right">946</td><td align="right">958</td><td align="right">1013</td><td align="right">1190</td><td align="right">1209</td></tr><tr><td align="left">Seq Q32T1 Write</td><td align="right">259</td><td align="right">32</td><td align="right">293</td><td align="right">37</td><td align="right">534</td><td align="right">50</td></tr><tr><td align="left">4KB Q8T8 Read</td><td align="right">40</td><td align="right">38</td><td align="right">67</td><td align="right">64</td><td align="right">103</td><td align="right">99</td></tr><tr><td align="left">4KB Q8T8 Write</td><td align="right">17</td><td align="right">2.5</td><td align="right">18</td><td align="right">3</td><td align="right">27</td><td align="right">4.3</td></tr><tr><td align="left">4KB Q32T1 Read</td><td align="right">43</td><td align="right">41</td><td align="right">69</td><td align="right">65</td><td align="right">100</td><td align="right">83</td></tr><tr><td align="left">4KB Q32T1 Write</td><td align="right">14</td><td align="right">1.7</td><td align="right">17</td><td align="right">2</td><td align="right">25</td><td align="right">2.7</td></tr><tr><td align="left">4KB Q1T1 Read</td><td align="right">21</td><td align="right">20</td><td align="right">21</td><td align="right">20</td><td align="right">19</td><td align="right">21</td></tr><tr><td align="left">4KB Q1T1 Write</td><td align="right">14</td><td align="right">0.40</td><td align="right">13</td><td align="right">0.42</td><td align="right">14</td><td align="right">0.45</td></tr></tbody></table><p>实测证明，ZIL对性能影响非常大，2个数量级的性能差异，非必要应尽量不开启ZIL。</p></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接：</strong> <a href="https://fenixadar.github.io/2022/08/15/%E5%A8%81%E8%81%94%E9%80%9ANAS%20TS-873A%20%E5%AE%9E%E6%B5%8B/" title="威联通NAS TS-873A 实测" target="_blank" rel="external">https://fenixadar.github.io/2022/08/15/威联通NAS TS-873A 实测/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="https://github.com/fenixadar" target="_blank" class="img-burn thumb-sm visible-lg"><img src="/images/avatar.jpg" class="img-rounded w-full" alt=""></a></div><div class="media-body"><h3 class="media-heading"><a href="https://github.com/fenixadar" target="_blank"><span class="text-dark">FenixAdar</span><small class="ml-1x"></small></a></h3><div></div></div></figure></div></div></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/2022/09/10/%E4%B8%AA%E4%BA%BA%E8%99%9A%E6%8B%9F%E5%8C%96%E5%AD%98%E7%AE%97%E5%88%86%E7%A6%BB%E6%94%B9%E9%80%A0/" title="个人虚拟化存算分离改造"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a></li><li class="next"><a href="/2022/08/04/%E6%9E%81%E7%AE%80Prometheus%E7%9B%91%E6%8E%A7%E5%AE%9E%E6%88%98/" title="极简Prometheus监控实战"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li></ul><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div></div></div></nav></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><div class="copyright"><div class="publishby"></div></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta=(meta="nick,mail,link").split(",").filter(function(e){return-1<GUEST.indexOf(e)});new Valine({el:"#vcomments",verify:!1,notify:!1,appId:"4MYosLYygYLCriqKTHXATgkP-gzGzoHsz",appKey:"RANI0qaGuUN6feTLpxeFAf4K",placeholder:"么恭虾米",avatar:"retro",meta:meta,pageSize:"20",visitor:!1})</script></body></html>